---
description: Avoid useEffect antipatterns
globs: *.tsx
alwaysApply: false
---

# Avoid useEffect at all cost

[You Might Not Need `useEffect`](https://react.dev/learn/you-might-not-need-an-effect)

Instead of using `useEffect`, prefer:

- Server actions
- Ref callbacks
- Event handlers with `flushSync`
- CSS
- `useSyncExternalStore`
- `useSWR` or `react-query` if already in project

## Example: Event Handlers (Good)

```tsx
// ✅ Good
function ProductPage({ product, addToCart }) {
  function buyProduct() {
    addToCart(product);
    showNotification(`Added ${product.name} to the shopping cart!`);
  }

  function handleBuyClick() {
    buyProduct();
  }

  function handleCheckoutClick() {
    buyProduct();
    navigateTo('/checkout');
  }
  // ...
}
```

## Example: State Updates (Bad)

```tsx
// ❌ Avoid
function ProductPage({ product, addToCart }) {
  useEffect(() => {
    if (product.isInCart) {
      showNotification(`Added ${product.name} to the shopping cart!`);
    }
  }, [product]);

  function handleBuyClick() {
    addToCart(product);
  }
  // ...
}
```

## When useEffect IS Appropriate

Only use `useEffect` for external system synchronization:

```tsx
// ✅ Good - Syncing with external system
useEffect(() => {
  const controller = new AbortController();

  window.addEventListener(
    'keydown',
    (event: KeyboardEvent) => {
      if (event.key !== 'Escape') return;
      // do something based on escape key being pressed
    },
    { signal: controller.signal }
  );

  return () => {
    controller.abort();
  };
}, []);
```

`useEffect` is not banned, but there are usually better ways to handle most cases.
